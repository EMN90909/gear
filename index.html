<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Content Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet" />
    <link rel="stylesheet" href="template.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A soft, calming background color */
            padding: 2rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        #editor-container {
            height: 450px;
            background-color: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #preview-frame {
            border: none;
            width: 100%;
            height: 100%;
            border-radius: 0.75rem;
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .ql-toolbar.ql-snow {
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
            background-color: #f9fafb;
            border-color: #e5e7eb;
        }
        .ql-container.ql-snow {
            border-bottom-left-radius: 0.75rem;
            border-bottom-right-radius: 0.75rem;
            border-color: #e5e7eb;
        }
        .ql-editor {
            font-size: 1rem;
            line-height: 1.6;
        }
    </style>
</head>
<body class="p-4">

    <div class="container bg-white p-8 rounded-2xl shadow-2xl space-y-8">
        <h1 class="text-4xl font-bold text-center text-gray-800">HTML Content Generator</h1>
        <p class="text-center text-gray-500 max-w-2xl mx-auto">
            Create and edit rich text on the left. Choose a template and see a live preview on the right.
        </p>

        <div class="space-y-4">
            <div class="flex flex-col sm:flex-row items-center justify-center sm:space-x-4 space-y-4 sm:space-y-0">
                <div class="w-full sm:w-1/3">
                    <label for="pageTitleInput" class="block text-sm font-medium text-gray-700 mb-2">Page Title</label>
                    <input type="text" id="pageTitleInput" placeholder="My Web Page"
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500" />
                </div>
                <div class="w-full sm:w-1/3">
                    <label for="fileNameInput" class="block text-sm font-medium text-gray-700 mb-2">File Name</label>
                    <input type="text" id="fileNameInput" placeholder="my-document"
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500" />
                </div>
                <button id="chooseTemplateBtn"
                    class="w-full sm:w-1/3 px-8 py-3 bg-blue-500 text-white font-semibold rounded-full shadow-lg
                    hover:bg-blue-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2">
                    Choose Template
                </button>
            </div>
            <div class="flex justify-center">
                <button id="customCssBtn"
                    class="w-full sm:w-auto px-8 py-3 bg-gray-200 text-gray-800 font-semibold rounded-full shadow-lg
                    hover:bg-gray-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                    Custom CSS
                </button>
            </div>
            <div id="customCssContainer" class="mt-4 hidden">
                <label for="customCssInput" class="block text-sm font-medium text-gray-700 mb-2">Add Your Custom CSS Here</label>
                <textarea id="customCssInput" rows="6" placeholder="body { background-color: #fef3c7; }"
                            class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-4">
                <label for="editor-container" class="block text-sm font-medium text-gray-700">Rich Text Editor</label>
                <div id="editor-container"></div>
            </div>

            <div class="space-y-4">
                <label for="preview-frame" class="block text-sm font-medium text-gray-700">Live Preview</label>
                <div class="p-4 rounded-xl shadow-lg border border-gray-300 overflow-hidden" style="height: 450px;">
                    <iframe id="preview-frame"></iframe>
                </div>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="copyBtn"
                    class="w-full sm:w-auto px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-full shadow-lg
                    hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Copy HTML
            </button>
            <button id="downloadBtn"
                    class="w-full sm:w-auto px-8 py-4 bg-green-600 text-white text-lg font-semibold rounded-full shadow-lg
                    hover:bg-green-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                Download HTML
            </button>
        </div>

        <div id="messageBox" class="text-center font-medium text-sm transition-opacity duration-300 opacity-0"></div>
    </div>

    <div id="templateModal" class="hidden modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-6 text-center">Select a Template</h2>
            <span id="closeModalBtn" class="modal-close-btn">&times;</span>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="template-card p-4 rounded-xl border border-gray-300 text-center" data-template="book">
                    <h3 class="font-bold text-lg mb-2">Classic Book</h3>
                    <p class="text-sm text-gray-600 mb-4">A traditional, serif-based style with a clean, scholarly feel.</p>
                    <div class="w-full h-32 rounded-lg bg-white overflow-hidden shadow-inner flex items-center justify-center text-center">
                        <p class="template-preview-text template-book">
                            A classic look.
                        </p>
                    </div>
                </div>
                <div class="template-card p-4 rounded-xl border border-gray-300 text-center" data-template="blog">
                    <h3 class="font-bold text-lg mb-2">Modern Blog Post</h3>
                    <p class="text-sm text-gray-600 mb-4">A clean, sans-serif design for a contemporary online article.</p>
                    <div class="w-full h-32 rounded-lg bg-white overflow-hidden shadow-inner flex items-center justify-center text-center">
                        <p class="template-preview-text template-blog">
                            A modern look.
                        </p>
                    </div>
                </div>
                <div class="template-card p-4 rounded-xl border border-gray-300 text-center" data-template="minimal">
                    <h3 class="font-bold text-lg mb-2">Minimalist Document</h3>
                    <p class="text-sm text-gray-600 mb-4">A stripped-back style focused on legibility and simplicity.</p>
                    <div class="w-full h-32 rounded-lg bg-white overflow-hidden shadow-inner flex items-center justify-center text-center">
                        <p class="template-preview-text template-minimal">
                            A minimalist look.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.js"></script>
    <script>
        // Get references to HTML elements
        const pageTitleInput = document.getElementById('pageTitleInput');
        const fileNameInput = document.getElementById('fileNameInput');
        const customCssBtn = document.getElementById('customCssBtn');
        const customCssContainer = document.getElementById('customCssContainer');
        const customCssInput = document.getElementById('customCssInput');
        const chooseTemplateBtn = document.getElementById('chooseTemplateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const messageBox = document.getElementById('messageBox');
        const previewFrame = document.getElementById('preview-frame');
        const templateModal = document.getElementById('templateModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const templateCards = document.querySelectorAll('.template-card');
        
        let currentTemplate = 'book'; // Default template

        // Configuration for Quill.js toolbar
        const toolbarOptions = [
            ['bold', 'italic', 'underline', 'strike'],
            ['blockquote', 'code-block'],
            [{ 'header': 1 }, { 'header': 2 }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            [{ 'script': 'sub'}, { 'script': 'super' }],
            [{ 'indent': '-1'}, { 'indent': '+1' }],
            [{ 'direction': 'rtl' }],
            [{ 'size': ['small', false, 'large', 'huge'] }],
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
            [{ 'color': [] }, { 'background': [] }],
            [{ 'font': [] }],
            [{ 'align': [] }],
            ['clean']
        ];

        // Initialize Quill editor on the editor-container div
        const quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: toolbarOptions
            }
        });

        /**
         * Updates the content of the live preview iframe with the current HTML and selected template.
         */
        function updateLivePreview() {
            const editorHtml = quill.root.innerHTML;
            const doc = previewFrame.contentWindow.document;
            const title = pageTitleInput.value || 'Untitled Document';
            const customCss = customCssInput.value;

            doc.open();
            doc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${title}</title>
                    <link rel="stylesheet" href="template.css">
                    <style>
                        /* Custom CSS added by the user */
                        ${customCss}
                    </style>
                </head>
                <body class="template-${currentTemplate}">
                    ${editorHtml}
                </body>
                </html>
            `);
            doc.close();
        }

        /**
         * Generates the complete, self-contained HTML file content.
         * @returns {string} The full HTML content.
         */
        function generateFullHtml() {
            const editorHtml = quill.root.innerHTML;
            const title = pageTitleInput.value || 'Untitled Document';
            const customCss = customCssInput.value;

            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <link rel="stylesheet" href="template.css">
    <style>
        /* Custom CSS added by the user */
        ${customCss}
    </style>
</head>
<body class="template-${currentTemplate}">
    ${editorHtml}
</body>
</html>`;
        }
        
        /**
         * Displays a temporary message in the message box.
         * @param {string} message The message to display.
         * @param {string} color The Tailwind CSS color class (e.g., 'text-green-500').
         */
        function showMessage(message, color) {
            messageBox.textContent = message;
            messageBox.className = `text-center font-medium text-sm transition-opacity duration-300 ${color}`;
            // Make the message visible and then fade it out after a delay
            setTimeout(() => {
                messageBox.style.opacity = '1';
                setTimeout(() => {
                    messageBox.style.opacity = '0';
                }, 3000); // 3 seconds
            }, 100);
        }

        // Add event listeners for the modal
        chooseTemplateBtn.addEventListener('click', () => {
            templateModal.classList.remove('hidden');
        });
        closeModalBtn.addEventListener('click', () => {
            templateModal.classList.add('hidden');
        });
        templateModal.addEventListener('click', (e) => {
            if (e.target === templateModal) {
                templateModal.classList.add('hidden');
            }
        });

        // Add click listeners to template cards
        templateCards.forEach(card => {
            card.addEventListener('click', () => {
                // Remove selected class from all cards
                templateCards.forEach(c => c.classList.remove('selected'));
                // Add selected class to the clicked card
                card.classList.add('selected');
                
                currentTemplate = card.dataset.template;
                updateLivePreview();
                templateModal.classList.add('hidden');
            });
        });

        // Add event listener to toggle the custom CSS input
        customCssBtn.addEventListener('click', () => {
            customCssContainer.classList.toggle('hidden');
        });

        // Add event listener for the Copy button
        copyBtn.addEventListener('click', () => {
            const htmlContent = generateFullHtml();
            navigator.clipboard.writeText(htmlContent)
                .then(() => {
                    showMessage('HTML copied to clipboard!', 'text-blue-500');
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                    showMessage('Copy failed, please try again.', 'text-red-500');
                });
        });

        // Add event listener for the Download button
        downloadBtn.addEventListener('click', () => {
            const htmlContent = generateFullHtml();
            const fileName = fileNameInput.value.trim() || 'my-document';
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showMessage('HTML file downloaded successfully!', 'text-green-500');
        });

        // Update the live preview whenever the content of the editor, page title, or custom CSS changes
        quill.on('text-change', () => {
            updateLivePreview();
        });
        pageTitleInput.addEventListener('input', () => {
            updateLivePreview();
        });
        customCssInput.addEventListener('input', () => {
            updateLivePreview();
        });

        // Initial preview update on page load
        window.onload = () => {
            // Set the default selected card
            document.querySelector(`[data-template="book"]`).classList.add('selected');
            updateLivePreview();
        };
    </script>
</body>
</html>
