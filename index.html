<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Content Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet" />
    <!-- template.css is still included; ensure it contains any global styles you need -->
    <link rel="stylesheet" href="template.css">
    <style>
        /* General body and container styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A soft, calming background color */
            padding: 2rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Editor and Preview specific styles */
        #editor-container {
            height: 450px;
            background-color: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #preview-frame {
            border: none;
            width: 100%;
            height: 100%;
            border-radius: 0.75rem;
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Quill editor styles */
        .ql-toolbar.ql-snow {
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
            background-color: #f9fafb;
            border-color: #e5e7eb;
        }
        .ql-container.ql-snow {
            border-bottom-left-radius: 0.75rem;
            border-bottom-right-radius: 0.75rem;
            border-color: #e5e7eb;
        }
        .ql-editor {
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out;
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 2rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.2s;
        }
        .modal-close-btn:hover {
            color: #1f2937;
        }
        .hidden {
            display: none;
        }
        /* No longer needed: .template-card, .selected etc. for the template modal */
        /* Template preview text styles might still be relevant if used elsewhere */
        .template-preview-text {
            font-size: 0.9rem;
            color: #4b5563;
        }
        .template-preview-text.template-book { font-family: Georgia, serif; }
        .template-preview-text.template-blog { font-family: 'Inter', sans-serif; font-weight: 500;}
        .template-preview-text.template-minimal { font-family: 'Inter', sans-serif; font-weight: 400; letter-spacing: 0.02em; }

        /* Animation for modal */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="p-4">

    <div class="container bg-white p-8 rounded-2xl shadow-2xl space-y-8">
        <h1 class="text-4xl font-bold text-center text-gray-800">HTML Content Generator</h1>
        <p class="text-center text-gray-500 max-w-2xl mx-auto">
            Create and edit rich text on the left. See a live preview on the right.
        </p>

        <div class="space-y-4">
            <div class="flex flex-col sm:flex-row items-center justify-center sm:space-x-4 space-y-4 sm:space-y-0">
                <div class="w-full sm:w-1/2">
                    <label for="pageTitleInput" class="block text-sm font-medium text-gray-700 mb-2">Page Title</label>
                    <input type="text" id="pageTitleInput" placeholder="My Web Page"
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500" />
                </div>
                <div class="w-full sm:w-1/2">
                    <label for="fileNameInput" class="block text-sm font-medium text-gray-700 mb-2">File Name</label>
                    <input type="text" id="fileNameInput" placeholder="my-document"
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500" />
                </div>
                <!-- Removed "Choose Template" button -->
            </div>
            <!-- Custom CSS & JS buttons -->
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="customCssBtn"
                    class="w-full sm:w-auto px-8 py-3 bg-gray-200 text-gray-800 font-semibold rounded-full shadow-lg
                    hover:bg-gray-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                    Custom CSS
                </button>
                <button id="customJsBtn"
                    class="w-full sm:w-auto px-8 py-3 bg-gray-200 text-gray-800 font-semibold rounded-full shadow-lg
                    hover:bg-gray-300 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                    Custom JavaScript
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-4">
                <label for="editor-container" class="block text-sm font-medium text-gray-700">Rich Text Editor</label>
                <div id="editor-container"></div>
            </div>

            <div class="space-y-4">
                <label for="preview-frame" class="block text-sm font-medium text-gray-700">Live Preview</label>
                <div class="p-4 rounded-xl shadow-lg border border-gray-300 overflow-hidden" style="height: 450px;">
                    <iframe id="preview-frame"></iframe>
                </div>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="copyBtn"
                    class="w-full sm:w-auto px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-full shadow-lg
                    hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Copy HTML
            </button>
            <button id="downloadBtn"
                    class="w-full sm:w-auto px-8 py-4 bg-green-600 text-white text-lg font-semibold rounded-full shadow-lg
                    hover:bg-green-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                Download HTML
            </button>
        </div>

        <div id="messageBox" class="text-center font-medium text-sm transition-opacity duration-300 opacity-0"></div>
    </div>

    <!-- Removed Interstitial and Template Selection Modals -->

    <!-- NEW: Custom Code (CSS/JS) Modal -->
    <div id="customCodeModal" class="hidden modal-overlay">
        <div class="modal-content">
            <h2 id="customCodeTitle" class="text-2xl font-bold mb-6 text-center text-gray-800">Edit Custom Code</h2>
            <span id="closeCustomCodeModalBtn" class="modal-close-btn">&times;</span>
            <textarea id="customCodeEditor" rows="15" placeholder="Enter your custom code here..."
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm resize-y"></textarea>
            <div class="flex justify-end gap-4 mt-6">
                <button id="customCodeCancelBtn" class="px-4 py-2 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold transition-colors">
                    Cancel
                </button>
                <button id="customCodeSaveBtn" class="px-4 py-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white font-semibold transition-colors">
                    Save Code
                </button>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.js"></script>
    <script>
        // Get references to HTML elements
        const pageTitleInput = document.getElementById('pageTitleInput');
        const fileNameInput = document.getElementById('fileNameInput');
        const customCssBtn = document.getElementById('customCssBtn');
        const customJsBtn = document.getElementById('customJsBtn'); // NEW: JS Button
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const messageBox = document.getElementById('messageBox');
        const previewFrame = document.getElementById('preview-frame');
        
        // NEW: Custom Code Modal Elements
        const customCodeModal = document.getElementById('customCodeModal');
        const customCodeTitle = document.getElementById('customCodeTitle');
        const customCodeEditor = document.getElementById('customCodeEditor');
        const customCodeSaveBtn = document.getElementById('customCodeSaveBtn');
        const customCodeCancelBtn = document.getElementById('customCodeCancelBtn');
        const closeCustomCodeModalBtn = document.getElementById('closeCustomCodeModalBtn');
        
        // Global variables for custom CSS and JS, initialized from local storage
        let customCss = localStorage.getItem('htmlGeneratorCustomCss') || '';
        let customJs = localStorage.getItem('htmlGeneratorCustomJs') || '';
        let currentModalMode = ''; // To track whether we're editing 'css' or 'js'

        // Configuration for Quill.js toolbar
        const toolbarOptions = [
            ['bold', 'italic', 'underline', 'strike'],
            ['blockquote', 'code-block'],
            [{ 'header': 1 }, { 'header': 2 }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            [{ 'script': 'sub'}, { 'script': 'super' }],
            [{ 'indent': '-1'}, { 'indent': '+1' }],
            [{ 'direction': 'rtl' }],
            [{ 'size': ['small', false, 'large', 'huge'] }],
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
            [{ 'color': [] }, { 'background': [] }],
            [{ 'font': [] }],
            [{ 'align': [] }],
            ['clean']
        ];

        // Initialize Quill editor on the editor-container div
        const quill = new Quill('#editor-container', {
            theme: 'snow',
            modules: {
                toolbar: toolbarOptions
            }
        });

        /**
         * Updates the content of the live preview iframe with the current HTML and selected template.
         */
        function updateLivePreview() {
            const editorHtml = quill.root.innerHTML;
            const doc = previewFrame.contentWindow.document;
            const title = pageTitleInput.value || 'Untitled Document';
            // customCss is now a global variable
            // customJs is now a global variable

            doc.open();
            doc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${title}</title>
                    <!-- Include Tailwind CSS CDN for the preview -->
                    <script src="https://cdn.tailwindcss.com"></script>
                    <!-- template.css might still contain useful global styles not specific to a "template" design -->
                    <link rel="stylesheet" href="template.css">
                    <style>
                        /* Custom CSS added by the user */
                        ${customCss}
                        /* Added for 3cm horizontal gap for the entire page body */
                        body {
                            padding-left: 3cm;
                            padding-right: 3cm;
                            box-sizing: border-box; /* To ensure padding doesn't add to total width */
                            /* Default background color for the content, if not set by Quill or custom CSS */
                            background-color: white; 
                        }
                        /* Centering for the main content within the body */
                        .main-content {
                            max-width: 800px; /* Readable line length */
                            margin: 0 auto; /* Center the block */
                        }
                    </style>
                </head>
                <body>
                    <div class="main-content">
                        ${editorHtml}
                    </div>
                    <script>
                        // Custom JavaScript added by the user
                        ${customJs}
                    </script>
                </body>
                </html>
            `);
            doc.close();
        }

        /**
         * Generates the complete, self-contained HTML file content.
         * @returns {string} The full HTML content.
         */
        function generateFullHtml() {
            const editorHtml = quill.root.innerHTML;
            const title = pageTitleInput.value || 'Untitled Document';
            // customCss is now a global variable
            // customJs is now a global variable

            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title}</title>
    <!-- Include Tailwind CSS CDN for the downloaded file -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- template.css might still contain useful global styles not specific to a "template" design -->
    <link rel="stylesheet" href="template.css">
    <style>
        /* Custom CSS added by the user */
        ${customCss}
        /* Added for 3cm horizontal gap for the entire page body */
        body {
            padding-left: 3cm;
            padding-right: 3cm;
            box-sizing: border-box; /* To ensure padding doesn't add to total width */
            /* Default background color for the content, if not set by Quill or custom CSS */
            background-color: white; 
        }
        /* Centering for the main content within the body */
        .main-content {
            max-width: 800px; /* Readable line length */
            margin: 0 auto; /* Center the block */
        }
    </style>
</head>
<body>
    <div class="main-content">
        ${editorHtml}
    </div>
    <script>
        // Custom JavaScript added by the user
        ${customJs}
    </script>
</body>
</html>`;
        }
        
        /**
         * Displays a temporary message in the message box.
         * @param {string} message The message to display.
         * @param {string} color The Tailwind CSS color class (e.g., 'text-green-500').
         */
        function showMessage(message, color) {
            messageBox.textContent = message;
            // Clear previous color classes before adding new one
            messageBox.className = `text-center font-medium text-sm transition-opacity duration-300 ${color}`;
            // Make the message visible and then fade it out after a delay
            setTimeout(() => {
                messageBox.style.opacity = '1';
                setTimeout(() => {
                    messageBox.style.opacity = '0';
                }, 3000); // 3 seconds
            }, 100);
        }

        // --- Event Listeners for Custom Code Modal ---

        // Open Custom CSS Modal
        customCssBtn.addEventListener('click', () => {
            currentModalMode = 'css';
            customCodeTitle.textContent = 'Edit Custom CSS';
            customCodeEditor.value = customCss;
            customCodeModal.classList.remove('hidden');
            customCodeEditor.focus();
        });

        // Open Custom JavaScript Modal
        customJsBtn.addEventListener('click', () => {
            currentModalMode = 'js';
            customCodeTitle.textContent = 'Edit Custom JavaScript';
            customCodeEditor.value = customJs;
            customCodeModal.classList.remove('hidden');
            customCodeEditor.focus();
        });

        // Save Custom Code
        customCodeSaveBtn.addEventListener('click', () => {
            if (currentModalMode === 'css') {
                customCss = customCodeEditor.value;
                localStorage.setItem('htmlGeneratorCustomCss', customCss);
                showMessage('Custom CSS saved!', 'text-blue-500');
            } else if (currentModalMode === 'js') {
                customJs = customCodeEditor.value;
                localStorage.setItem('htmlGeneratorCustomJs', customJs);
                showMessage('Custom JavaScript saved!', 'text-blue-500');
            }
            customCodeModal.classList.add('hidden');
            updateLivePreview(); // Re-render preview with new custom code
        });

        // Cancel Custom Code Editing
        customCodeCancelBtn.addEventListener('click', () => {
            customCodeModal.classList.add('hidden');
        });

        // Close Custom Code Modal with X button
        closeCustomCodeModalBtn.addEventListener('click', () => {
            customCodeModal.classList.add('hidden');
        });

        // Close Custom Code Modal when clicking outside
        customCodeModal.addEventListener('click', (e) => {
            if (e.target === customCodeModal) {
                customCodeModal.classList.add('hidden');
            }
        });


        // Add event listener for the Copy button
        copyBtn.addEventListener('click', () => {
            const htmlContent = generateFullHtml();
            navigator.clipboard.writeText(htmlContent)
                .then(() => {
                    showMessage('HTML copied to clipboard!', 'text-blue-500');
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                    showMessage('Copy failed, please try again.', 'text-red-500');
                });
        });

        // Add event listener for the Download button
        downloadBtn.addEventListener('click', () => {
            const htmlContent = generateFullHtml();
            const fileName = fileNameInput.value.trim() || 'my-document';
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${fileName}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showMessage('HTML file downloaded successfully!', 'text-green-500');
        });

        // Update the live preview whenever the content of the editor, page title, or custom CSS changes
        quill.on('text-change', () => {
            updateLivePreview();
        });
        pageTitleInput.addEventListener('input', () => {
            updateLivePreview();
        });
        // Now customCssInput is the textarea inside the modal, so its 'input' event won't trigger live update directly
        // The update happens when the custom code modal is saved.

        // Initial preview update on page load
        window.onload = () => {
            // Start with a blank editor (or a default message)
            quill.setContents([{ insert: 'Start typing your content here...' }]); 
            updateLivePreview();
        };
    </script>
</body>
</html>
